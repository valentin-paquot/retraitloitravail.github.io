/* AST v0.3.8 Updated : 2016-05-26 */
!function(e){function t(a){if(n[a])return n[a].exports;var r=n[a]={exports:{},id:a,loaded:!1};return e[a].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){n(1),n(4),n(8),n(5),n(10),n(6),n(7),n(9),e.exports=n(2)},function(e,t,n){function a(e){if(e.nobid)return this.nobid=!0,this.tagId=e.tag_id,this.auctionId=e.auction_id,this;e.ads&&e.ads.length>1;var t=e.ads[0];if(this.adType=t.ad_type,this.buyerMemberId=t.buyer_member_id,this.tagId=e.tag_id,this.auctionId=e.auction_id,this.source=t.content_source,this.cpm=t.cpm,this.creativeId=t.creative_id,t.rtb&&t.rtb.banner)this.banner={width:t.rtb.banner.width,height:t.rtb.banner.height,content:t.rtb.banner.content,trackers:t.rtb.trackers};else if(t.rtb&&t.rtb.video){var n=t.rtb.video;this.video={duration:n.duration_ms,playbackMethods:n.playback_methods,frameworks:n.frameworks,content:n.content,trackers:t.rtb.trackers}}else if(t.rtb&&t.rtb[o.MEDIA_TYPE.NATIVE]){var a=t.rtb[o.MEDIA_TYPE.NATIVE][o.MEDIA_TYPE.NATIVE][0];this[o.MEDIA_TYPE.NATIVE]={type:a.type,title:a.title,description:a.description,fullText:a.fullText,iconImgUrl:a.icon_img_url,mainMedia:a.main_media,cta:a.cta,sponsoredBy:a.sponsored_by,impressionTrackers:a.impression_trackers,clickTrackers:a.click_trackers,rating:a.rating,clickUrl:a.click_url,clickFallbackUrl:a.click_fallback_url,custom:a.custom}}}var r=n(2),o=n(3),i={},s=function(e){return new a(e)};t.getAdObj=function(e){if(!e||!e.uuid)return{};if(i[e.uuid])return i[e.uuid];try{var t=s(e);return i[e.uuid]=t,t}catch(n){r.logError("adManager.getAdObj: Error trying to instantiate new adObj: "+n.message)}},t.getAdErrorObj=function(e,t,n,a){return{code:a,errMessage:e||n.message,exception:n,targetId:t}}},function(e,t,n){var a=n(3),r="Array",o="String",i="Function",s="Number",d=Object.prototype.hasOwnProperty,g=!1,u=a.DEBUG.DEBUG_MODE,l=a.OBJECT_TYPE.UNDEFINED,c=null;try{c="object"==typeof console.info?console.info:console.info.bind(window.console)}catch(p){}t.addEventHandler=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!0):e.attachEvent&&e.attachEvent("on"+t,n)},t.isA=function(e,t){return Object.prototype.toString.call(e)==="[object "+t+"]"},t.isFn=function(e){return this.isA(e,i)},t.isStr=function(e){return this.isA(e,o)},t.isArray=function(e){return this.isA(e,r)},t.isNumber=function(e){return this.isA(e,s)},t.isEmpty=function(e){if(!e)return!0;if(this.isArray(e)||this.isStr(e))return!(e.length>0);for(var t in e)if(d.call(e,t))return!1;return!0},t.logMessage=function(e){var t=m();this.debugTurnedOn()&&f()&&console.log(t+"MESSAGE: "+e)},t.logWarn=function(e){var t=m();this.debugTurnedOn()&&f()&&(console.warn?console.warn(t+"WARN: "+e):console.log(t+"WARN: "+e))},t.logError=function(e,t){var n=t||"GENERAL_ERROR",a=m();this.debugTurnedOn()&&f()&&(console.error?console.error(a+n+": "+e):console.log(a+n+": "+e))},t.logTimestamp=function(e){this.debugTurnedOn()&&f()&&console.timeStamp&&console.timeStamp(e)},t.logInfo=function(e,t){if(this.debugTurnedOn()&&f()){var n=m();c&&(t&&0!==t.length||(t=""),c(n+"INFO: "+e+(""===t?"":" : params : "),t))}},t.loadScript=function(e,t,n){var a=e.document,r=a.createElement("script");r.type="text/javascript",r.async=!0,n&&"function"==typeof n&&(r.readyState?r.onreadystatechange=function(){"loaded"!==r.readyState&&"complete"!==r.readyState||(r.onreadystatechange=null,n())}:r.onload=function(){n()}),r.src=t;var o=a.getElementsByTagName("head");return o=o.length?o:a.getElementsByTagName("body"),o.length&&(o=o[0],o.insertBefore(r,o.firstChild)),r},t.getUUID=function(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)});return t},t.loadPixelUrl=function(e,t,n){var a,r=e.document.getElementsByTagName("head");if(e&&r&&t){a=new Image,a.id=n,a.src=t,a.height=0,a.width=0,a.style.display="none",a.onload=function(){try{this.parentNode.removeChild(this)}catch(e){}};try{r=r.length?r:e.document.getElementsByTagName("body"),r.length&&(r=r[0],r.insertBefore(a,r.firstChild))}catch(o){this.logError("Error logging impression for tag: "+n+" :"+o.message)}}},t._each=function(e,t){if(!this.isEmpty(e)){if(this.isFn(e.forEach))return e.forEach(t);var n=0,a=e.length;if(a>0)for(;a>n;n++)t(e[n],n,e);else for(n in e)d.call(e,n)&&t(e[n],n,e)}},t.contains=function(e,t){if(this.isEmpty(e))return!1;for(var n=e.length;n--;)if(e[n]===t)return!0;return!1};var f=function(){return window.console&&window.console.log};t.debugTurnedOn=function(){return apntag.debug===!1&&g===!1&&(apntag.debug="TRUE"===this.getParameterByName(u).toUpperCase(),g=!0),!!apntag.debug},t.stringContains=function(e,t){return-1!=e.indexOf(t)},t.getSearchQuery=function(){try{return window.top.location.search}catch(e){return window.location.search}},t.getParameterByName=function(e,t){var n="[\\?&]"+e+"=([^&#]*)",a=new RegExp(n),r=a.exec(t||this.getSearchQuery());return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))},t.hasOwn=function(e,t){return e.hasOwnProperty?e.hasOwnProperty(t):typeof e[t]!==l&&e.constructor.prototype[t]!==e[t]};var m=function(){var e=new Date,t="["+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()+":"+e.getMilliseconds()+"] ";return t};t.getTargetArrayforRefresh=function(e){var t=[];return this.isArray(e)?t=e:this.isStr(e)&&t.push(e),t},t._map=function(e,t){if(this.isEmpty(e))return[];if(this.isFn(e.map))return e.map(t);var n=[];return this._each(e,function(a,r){n.push(t(a,r,e))}),n},t.getBrowserType=function(){var e=E(),t=/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return t[1]};var E=function(){return navigator.userAgent.toLowerCase()}},function(e,t){e.exports={PREFIX:{UT_IFRAME:"utif_",UT_DIV:"div_utif_"},LOG:{WARN:"WARN"},DEBUG:{DEBUG_MODE:"ast_debug",AST_DONGLE:"ast_dongle",AST_DEBUG_MEMBER:"ast_debug_member",AST_DEBUG_BIDDER:"ast_debug_bidder",AST_TEST:"ast_test",AST_OVERRIDE:{BASE:"ast_override_",DIV:"div",INDEX:"index",TAG_ID:"tag_id",INV_CODE:"inv_code"}},OBJECT_TYPE:{UNDEFINED:"undefined",OBJECT:"object",STRING:"string",NUMBER:"number"},BROWSER_TYPE:{IE:"msie",OPERA:"opera"},RENDERER_EVENTS:{LOADED:"loaded",IMPRESSION:"impression"},ENDPOINT:{UT_BASE:"/ut/v2",IMPBUS:"ib.adnxs.com"},UT_RESPONSE_PROP:{MEDIA_TYPE:"media_type",CREATIVE_ID:"creative_id",AD_TYPE:"ad_type",BANNER:"banner",VIDEO:"video",CONTENT:"content",UUID:"uuid"},MEDIA_TYPE:{BANNER:"banner",NATIVE:"native",VIDEO:"video"},AD:{CREATIVE_ID:"creative_id",NOTIFY:"notify_url",NOAD:"no_ad_url",IMP_URLS:"impression_urls",TRACKERS:"trackers"},CONTENT_SOURCE:{RTB:"rtb",CSM:"csm",SSM:"ssm"},AD_TYPE:{BANNER:"banner",NATIVE:"native",VIDEO:"video"},EXTERNAL_LIB:{VIDEO_MEDIATION_JS:"https://acdn.adnxs.com/video/astMediation/AstMediationManager.js",BANNER_MEDIATION_JS:"https://acdn.adnxs.com/mediation/v2/mediation.js"},EVENTS:{REQUEST:"adRequested",AVAILABLE:"adAvailable",LOADED:"adLoaded",REQUEST_FAIL:"adRequestFailure",NO_BID:"adNoBid",DEFAULT:"adDefault",ERROR:"adError",COLLAPSE:"adCollapse",BAD_REQUEST:"adBadRequest"}}},function(e,t,n){(function(e){function t(){if(re)try{}catch(e){re=v()}else re=v();return re}function a(e){e?(I=_.stringContains(e,"http")?e:t().document.location.protocol+"//"+e,_.logMessage("Setting endpoint to: "+I)):_.logError("Cannot set an empty endpoint")}function r(e){B[e.targetId]=ge(e)}function o(e){var t=he(e);return t}function i(e){return _.logMessage("getTag called for tag "+e),Ce(e)?e&&L[e]?L[e]:void 0:void _.logError("the "+e+" tag is not defined.",A.LOG.WARN)}function s(e){var t="defaultKey";return e.targetId&&(t=e.targetId),t}function d(e,t){_.logMessage("showTag called for "+e),x[e]=!0;var n=Ce(e);if(n){var a=apntag.requests.tags[e];if(a.showTagCalled=!0,a.curWindow=t,a.displayed)return void _.logWarn("Attempting to display ad that is already displayed, will not render this ad again: "+e);apntag.requests.utCalled?a.adResponse?(E(a),apntag.requests.hasLeft&&Pe()):apntag.requests.checkDisplay=!0:apntag.timeoutSet||_.logError("ut request did not call. This placement may be pending on other coordinated request on page")}else _.logMessage("the "+e+" tag was loaded before the ad placement was available.",A.LOG.WARN)}function g(e,t){var n=t,a=s(e);n||(n=B[a]);var r=null;if(!n)return void _.logError("Issue writing iframe into document. No ad available to render");try{r=JSON.parse(n)}catch(o){return void _.logError("Issue writing iframe into document :"+o.message)}if(r&&r.tags){var i=r.tags[0];if(!i)return void _.logError("Issue writing iframe into document. No ad available to render");var d=i.ad;if(d&&d.banner&&d.banner.content)try{window.document.write(d.banner.content),_.logTimestamp("Ad is loaded")}catch(o){_.logError("Issue writing iframe into document :"+o.message)}}}function u(e,t,n,a,r){_._each(P[t],function(t){l(e,t,n,a,r)})}function l(e,t,n,a,r){0===n&&(e="Failure to contact endpoint. This can be caused by invalid CORS headers or failure of server to respond.");var o=apntag.requests.tags[t];if(o)var i=R.getAdObj(o.adResponse);var s=R.getAdErrorObj(e,t,r,n);w.emit(a,t,s,i)}function c(e,t,n){_.logMessage("renderAd is called"),_._each(apntag.requests.tags,function(e){e.uuid===t&&(e.adResponse=n,E(e))})}function p(e){}function f(e){var t=null;if(apntag.requests.cbCalled=!0,typeof e===te||null===e||e.error){var n="malformed response from ad server";return e&&e.error&&(n=e.error),_.logError("Error response from impbus: "+n),void _._each(apntag.requests.tags,function(e,t){var a=R.getAdErrorObj(n,t,void 0,200);if(e)var r=R.getAdObj(e.adResponse);w.emit(A.EVENTS.BAD_REQUEST,t,a,r)})}e.debug&&e.debug.debug_info&&S.load(e.debug.debug_info),_._each(e.tags,function(e){if(e.error)return void _._each(apntag.requests.tags,function(t){if(t.uuid===e.uuid){var n="There was an exception from targetId:"+t.targetId+" this usually means there is a setup error on the tag (invalid ID etc)";_.logError(n,e.error);var a=R.getAdErrorObj(n,t.targetId,void 0,200);w.emit(A.EVENTS.BAD_REQUEST,t.targetId,a)}});var n=e.ads,a=N.checkIfMediatedResponse(n);a?_._each(apntag.requests.tags,function(a,r){if(a.uuid===e.uuid){a.utCalled=!0,a.isMediated=!0;var o=N.getMediationType(n),i=N.getMediationOptions(apntag.requests.tags,e);if(o===J)t=R.getAdObj(e),w.emit(A.EVENTS.AVAILABLE,r,t),N.callMediationFramework(o,e,i,c);else{var s=N.getContentForBannerMediation(a.targetId,e);e.ad={ad_type:W},a.ad={mediatedContent:s},m(a,e,r)}}}):_._each(apntag.requests.tags,function(t,n){m(t,e,n)})}),apntag.requests.checkDisplay&&Pe()}function m(e,t,n){e.uuid===t.uuid&&(t.nobid===!0?(_.logMessage("No bid for targetId:"+e.targetId),adObj=R.getAdObj(t),w.emit(A.EVENTS.NO_BID,n,adObj)):(e.adResponse=t,e.utCalled=!0,adObj=R.getAdObj(t),w.emit(A.EVENTS.AVAILABLE,n,adObj),e.prebid||e.displayed||E(e)))}function E(e){var n,a,r,o,i=t(),s=e.adResponse;if(e.adResponse&&e.adResponse.ads){var d=getAdObjFromAdsArray(e.adResponse.ads);d.banner&&(e.initialHeight=d.banner.height,e.initialWidth=d.banner.width)}if(r=N.getAdObjByMediation(e),null===r||typeof r.error!==te)return void b(s);if(typeof s!==te&&e.showTagCalled){if(s&&r.renderer_url&&r.renderer_id){var g=r.renderer_id,u=N.getContentSourceForMediation(r);if(typeof u===te)return void _.logError("No Content Source Found");r[r.ad_type]=u,D[g]?"function"==typeof D[g]?(y(e),N.copyAdObjforMediation(e),D[g].call(apntag,e,h),e.displayed=!0,o=R.getAdObj(e.adResponse),w.emit(A.EVENTS.LOADED,e.targetId,o),_.logTimestamp("The "+e.targetId+" ad is loaded.")):(q[g]=typeof q[g]===te?[]:q[g],q[g].push(e)):(_.loadScript(t(),r.renderer_url),q[g]=typeof q[g]===te?[]:q[g],q[g].push(e),D[g]=!0)}else if(r[F]===V)_.logMessage("Render for the following ad should be handled outside of ast.js :"+e.tagId),e.displayed=!0,o=R.getAdObj(e.adResponse),w.emit(A.EVENTS.LOADED,e.targetId,o),_.logTimestamp("The "+e.targetId+" ad is loaded.");else{if(r[F]===J)return void _.logWarn("Response has no renderer for video");if(r[F]===W){if(!e.isMediated){var l=r[H][G];if(_.isEmpty(l)||typeof l!==ne)return void _.logError("Response has no banner object");if(!_.hasOwn(l,Y))return void _.logError("Response has no banner content");if(!_.hasOwn(l,"width"))return void _.logError("Response has no banner width");if(!_.hasOwn(l,"height"))return void _.logError("Response has no banner height")}if(n=Ee(e),a=me(e),U[e.targetId]=n,a.appendChild(n),e.displayed=!0,i.document.body)try{e.showTagCalled&&(ve(e,a,n),a.style.display="inline")}catch(c){_.logError("Error rendering ad: "+c.message)}else _.logError("Error rendering ad: window.document.body is undefined")}else _.logError("Error rendering ad: unknown type")}C.push(e.targetId)}}function v(){var t,n=!1;try{var a=e&&e.window?e.window:window;do{if(a.parent.document.getElementsByTagName("frameset").length>0){n=!0;break}if(a.parent.document.getElementsByTagName("iframe").length>0)break;a=a.parent}while(a.document!==a.parent.document);if(n)for(var r=a.parent.document.getElementsByTagName("frame"),o=0;o<r.length;o++)if(r[o].contentWindow.document===a.document){a=r[o].contentWindow;break}t=a}catch(i){t=e.window}return t}function h(e,t,n){_.logMessage("handling event for:  "+e+" eventType : "+t),w.emit(t,e)}function y(e){var n=N.getAdObjByMediation(e);_.loadPixelUrl(t(),n[z],n[ee])}function b(e){_.loadPixelUrl(t(),e[K],e.uuid)}function T(e){for(var n=e[H][$][0][Z],a=0;a<n.length;a++)_.loadPixelUrl(t(),n[a],e[ee])}var I,_=n(2),w=n(5),A=n(3),N=(n(6),n(7)),S=n(8),O=n(9),R=n(1),D={},q={},C=[],P={},M=0,k=0,x={},B={},U={},L={},j=[],F=(A.UT_RESPONSE_PROP.MEDIA_TYPE,A.MEDIA_TYPE.NATIVE,A.UT_RESPONSE_PROP.AD_TYPE),V=A.AD_TYPE.NATIVE,W=A.AD_TYPE.BANNER,J=A.AD_TYPE.VIDEO,G=A.UT_RESPONSE_PROP.BANNER,Y=(A.UT_RESPONSE_PROP.VIDEO,A.UT_RESPONSE_PROP.CONTENT),z=A.AD.NOTIFY,H=A.CONTENT_SOURCE.RTB,Q=A.CONTENT_SOURCE.CSM,X=A.CONTENT_SOURCE.SSM,K=A.AD.NOAD,Z=A.AD.IMP_URLS,$=A.AD.TRACKERS,ee=(A.UT_RESPONSE_PROP.UUID,A.AD.CREATIVE_ID),te=(A.RENDERER_EVENTS.LOADED,A.OBJECT_TYPE.UNDEFINED),ne=A.OBJECT_TYPE.OBJECT,ae=A.OBJECT_TYPE.NUMBER,re=t();try{console.info?console.info("AST library loaded: 0.3.8"):console.log("AST library loaded: 0.3.8")}catch(oe){}apntag=typeof apntag!==te?apntag:{},apntag.anq=apntag.anq||[],apntag.debug=apntag.debug||!1,apntag.dongle=apntag.dongle||void 0,apntag.test=apntag.test||!1,apntag.loaded=!0,apntag.requests=apntag.requests||{},apntag.requests.keywords=apntag.requests.keywords||{},a(A.ENDPOINT.IMPBUS),apntag.requests.tagsOnPageCount=apntag.requests.tagsOnPageCount||M,apntag.requests.waitOnTagsCount=apntag.requests.waitOnTagsCount||k,apntag.requests.showTagDefinedMap=apntag.requests.showTagDefinedMap||x,apntag.highlightAd=function(e){if(_.logInfo("Invoking apntag.highlightAd",arguments),e){var t=U[e];t&&(t.style.border="3px solid #e67300")}},apntag.anq.push=function(e){e.call()},apntag.setEndpoint=function(e){_.logInfo("Invoking apntag.setEndpoint",arguments),a(e)},apntag.setPageOpts=function(e){_.logInfo("Invoking apntag.setPageOpts",arguments),e&&(e.member&&(apntag.requests.member=e.member),e.targetingParams&&(apntag.requests.targetingParams=e.targetingParams,_.logWarn("targetingParams will be deprecated soon. Please use keywords instead")),e.keywords&&(apntag.requests.keywords=e.keywords),e.user&&(apntag.requests.user=e.user),e.app&&(apntag.requests.app=e.app),e.device&&(apntag.requests.device=e.device),e.site&&(apntag.requests.site=e.site),e.disablePsa&&(apntag.requests.disablePsa=!0))},apntag.defineTag=function(e){_.logInfo("Invoking apntag.defineTag",arguments);var t=null;if(apntag.syncLoad?r(e):(t=o(e),j.push(t)),L[t.targetId])return L[t.targetId];var n={targetId:t.targetId,on:t.on,off:t.off,modifyTag:t.modifyTag};return L[t.targetId]=n,n},apntag.getAdWrap=function(e){return _.logInfo("Invoking apntag.getAdWrap",arguments),Ce(e)?e&&apntag.requests.tags&&apntag.requests.tags[e]&&apntag.requests.tags[e].adWrap?apntag.requests.tags[e].adWrap:void 0:void _.logError("the "+e+" tag is not defined.",A.LOG.WARN)},apntag.setSizes=function(e,t){return _.logInfo("Invoking apntag.setSizes",arguments),arguments.length<2&&(t=e,e=this.targetId),Ce(e)?void(apntag.requests.tags[e].sizes=t):void _.logError("the "+e+" tag is not defined.",A.LOG.WARN)},apntag.modifyTag=function(e,t){_.logInfo("Invoking apntag.modifyTag",arguments);var n={};return arguments.length<2&&(t=e,e=this.targetId),Ce(e)?(_._each(apntag.requests.tags[e],function(e,t){n[t]=e}),_._each(t,function(e,t){n[t]=e}),void(apntag.requests.tags[e]=n)):void _.logError("the "+e+" tag is not defined.",A.LOG.WARN)},apntag.onEvent=function(e,t,n){return _.logInfo("Invoking apntag.onEvent",arguments),arguments.length<3&&(n=t,t=this.targetId),Ce(t)?void w.on(e,t,n):void _.logError("the "+t+" tag is not defined.",A.LOG.WARN)},apntag.offEvent=function(e,t,n){if(_.logInfo("Invoking apntag.offEvent",arguments),arguments.length<2&&(t=this.targetId),!Ce(t))return void _.logError("the "+t+" tag is not defined.",A.LOG.WARN);if(_.isArray(e))for(var a=0;a<e.length;a++)w.off(e[a],t,n);else w.off(e,t,n)},apntag.loadTags=function(){_.logInfo("Invoking apntag.loadTags",arguments),Ie()},apntag.refresh=function(e){_.logInfo("Invoking apntag.refresh",arguments),ye(e)},apntag.showAdFromURL=function(e){_.logInfo("Invoking apntag.showAdFromURL",arguments);var t=ge(e);g(e,t)},apntag.resizeAd=function(e,n){_.logInfo("Invoking apntag.resizeAd",arguments);var a=0,r=0;if(_.isArray(n)&&2===n.length?(r=n[0],a=n[1]):_.logError("resizeAd must be invoked with a (targetId,[width, height])"),targetIframe=U[e],!targetIframe)return void _.logError("Failed to find target for resizeAd : "+e);var o=i(e),s=fe(o),d=t().document.getElementById(s);return d?(d.style.height=a,d.style.width=r,targetIframe.style.height=a+"px",targetIframe.style.width=r+"px",targetIframe.height=a,targetIframe.width=r,void _.logMessage("ResizeAd successful for targetId: "+e)):void _.logError("Failed to find target for resizeAd: "+e)},apntag.collapseAd=function(e,n,a){_.logInfo("Invoking apntag.collapseAd",arguments);var r,o=0,s=0,d=i(e);if(!d)return void _.logError("CollapseAd failed to find targetId : "+e);r=fe(d),typeof n===ae&&(o=n),typeof a===ae&&(s=a);var g=t().document.getElementById(r);if(null===g)return void _.logError("CollapseAd failed to find ad div : "+e);g.style.height=o,g.style.width=s,g.style.display="none";var u=apntag.requests.tags[e],l=R.getAdObj(u.adResponse);w.emit(A.EVENTS.COLLAPSE,e,l)},apntag.showTag=function(e,n){_.logInfo("Invoking apntag.showTag",arguments),n=n||t(),apntag.syncLoad?g(e):d(e,n)},apntag.setPageTargeting=function(e,t){_.logInfo("Invoking apntag.setPageTargeting",arguments),apntag.requests.targetingParams&&e&&t&&(apntag.requests.targetingParams[e]=t)},apntag.getPageTargeting=function(e){return _.logInfo("Invoking apntag.getPageTargeting",arguments),apntag.requests.targetingParams&&e?apntag.requests.targetingParams[e]:void 0},apntag.clearPageTargeting=function(e){_.logInfo("Invoking apntag.clearPageTargeting",arguments),apntag.requests.targetingParams&&e&&delete apntag.requests.targetingParams[e]},apntag.enableDebug=function(){apntag.debug=!0,_.logInfo("Invoking apntag.enableDebug",arguments)},apntag.disableDebug=function(){_.logInfo("Invoking apntag.disableDebug",arguments),apntag.debug=!1},apntag.registerRenderer=function(e,t){_.logInfo("Invoking apntag.registerRenderer",arguments),e&&_.isFn(t)?(D[e]=t,q[e]&&_._each(q[e],function(t){t.displayed||(y(t),N.copyAdObjforMediation(t),D[e].call(apntag,t,h),t.displayed=!0)})):_.logError("ast.js","registerRenderer must be called with (id, cbFn)")},apntag.recordErrorEvent=function(e,t){_.logInfo("Invoking apntag.recordErrorEvent",arguments);var n=apntag.requests.tags[t],a=R.getAdObj(n.adResponse),r=R.getAdErrorObj(e.message,t,e,200);w.emit(A.EVENTS.ERROR,t,r,a)};var ie=function(e){_._each(P[e],function(e){w.emit(A.EVENTS.REQUEST,e)}),_.logTimestamp("Ad is requested for member "+e)};apntag.clearRequest=function(){_.logInfo("Invoking apntag.clearRequest",arguments),apntag.requests={},apntag.requests.tags={},x={}},apntag.handleCb=function(e){_.logInfo("Invoking apntag.handleCb",arguments);try{f(e)}catch(t){var n=t.message?t.message:t;_.logError("Internal AST error : "+n);var a=p(e);u(n,a,200,A.EVENTS.BAD_REQUEST,t)}},apntag.emitEvent=function(e,t,n){_.logInfo("Invoking apntag.emitEvent",arguments),h(e,t,n)},apntag.getAdMarkup=function(e,t){if(apntag.requests.tags&&apntag.requests.tags[e]){var n=apntag.requests.tags[e];if(n.uuid===t)return n.adResponse.ads}},getAdObjFromAdsArray=function(e){if(e&&e.length>0){if(e[0][H])return e[0][H];if(e[0][Q])return e[0][Q];if(e[0][X])return e[0][X]}};var se=function(){for(var e=0;e<apntag.anq.length;e++)typeof apntag.anq[e].called===te&&(apntag.anq[e].call(),apntag.anq[e].called=!0)},de=function(e,t){var n=!0;return _._each(t,function(t){_.isEmpty(e[t])&&(_.logError("Tag has missing paramater: "+t),n=!1)}),n},ge=function(e){var t=["utUrlEncoded"];if(de(e,t)){var n=decodeURIComponent(e.utUrlEncoded),a=null,r=new XMLHttpRequest;return r.open("GET",n,!1),r.send(null),_.logTimestamp("Ad is requested"),200===r.status?a=r.responseText:_.logError("Error request ut URL"),a}},ue=function(e,t){var n=e.data,a=!0,r=r=new XMLHttpRequest;r.onload=function(){var e=null;if(200===r.status)try{e=JSON.parse(r.responseText),apntag.handleCb(e)}catch(n){_.logError("failed to parse ad response from impbus: "+n.message),u(n.message,t,r.status,A.EVENTS.REQUEST_FAIL,n)}else _.logError(r.status+" : "+r.statusText),u(r.statusText,t,r.status,A.EVENTS.REQUEST_FAIL)},r.onerror=function(n){var a=n.target.status,r="Error contacting impbus endpoint: "+e.url+" http response code:"+a;u(r,t,a,A.EVENTS.REQUEST_FAIL)},r.open("POST",e.url,a),r.setRequestHeader("Content-Type","text/plain"),r.withCredentials=!0;try{r.send(n),apntag.requests.utCalled=!0,ie(t)}catch(o){_.logError("Error making POST request: "+o),De(e,t)}},le=function(e){var t={},n=ce();return t.url=n,t.data=JSON.stringify(e),t},ce=function(){return I+A.ENDPOINT.UT_BASE},pe=function(e){return A.PREFIX.UT_IFRAME+e.targetId},fe=function(e){return A.PREFIX.UT_DIV+e.targetId},me=function(e){var n,a=fe(e),r=e.curWindow||t();return n=r.document.getElementById(a)?r.document.getElementById(a):r.document.createElement("div"),n.style.display="none",n.id=a,n},Ee=function(e){var n,a=pe(e),r=t();return n=null!==r.document.getElementById(a)?r.document.getElementById(a):r.document.createElement("iframe"),n.id=a,n.name=a,n.setAttribute("height",e.initialHeight),n.setAttribute("width",e.initialWidth),n.style.width=e.initialWidth+"px",n.style.height=e.initialHeight+"px",n.border="0",n.hspace="0",n.vspace="0",n.marginWidth="0",n.marginHeight="0",n.style.border="0",n.scrolling="no",n.frameBorder="0",n},ve=function(e,n,a){var r=_.getBrowserType(),o=e.curWindow||t(),i=o.document.getElementById(e.targetId);if(i){i.appendChild(n),e.utDivId=n.id,e.utiframeId=a.id,r===A.BROWSER_TYPE.IE||r===A.BROWSER_TYPE.OPERA?Ae(a,e,e.targetId):Ne(a,e,e.targetId),e.isMediated||(T(e.adResponse.ads[0]),_.logMessage("Win notification sent for ad tag: "+e.targetId));var s=N.getContentSourceForMediation(e.adResponse.ads[0]),d=Number(i.style.width.replace(/[^\d\.\-]/g,""));!isNaN(d)&&d>s.width&&("center"===e.promoAlignment?i.setAttribute("align","center"):i.setAttribute("align","left")),_.logMessage("The "+e.targetId+" ad is loaded."),_.logTimestamp("The "+e.targetId+" ad is loaded.");var g=R.getAdObj(e.adResponse);w.emit(A.EVENTS.LOADED,e.targetId,g)}else _.logWarn("No div element found for display ad. This ad will not show. Div id: "+e.targetId)},he=function(e){if(e.rid&&(apntag.requests.keywords.rid=e.rid),e.provider_id&&(apntag.requests.keywords.provider_id=e.provider_id),e.debug&&(apntag.debug=e.debug),e.size)return void _.logError("Size is deprecated, please use sizes instead.");if(e.member||(e.member=apntag.requests.member),e.member||(e.member="none"),!(e.tagId||e.invCode&&e.member))return void _.logError("tagId or (invCode & memberId) should be defined for targetId: "+e.targetId);try{var t=e.targetId,n=we(e,t);return _.logMessage("defineTag called for: "+t),apntag.requests&&apntag.requests.utCalled===!0&&!apntag.requests.tags[t].utCalled&&_.logMessage("A placement was loaded after ut call was started. These ad calls will not be coordinated"),n}catch(a){_.logError("buildAdTagContainer: "+a.message)}},ye=function(e){apntag.requests.utCalled=!1,apntag.requests.hasLeft=!1,apntag.requests.cbCalled=!1,apntag.requests.errorReported=!1;var n=_.getTargetArrayforRefresh(e),a=Te(n);_._each(a,function(e,n){_._each(C,function(e){if(n===e){var a=t().document,r=a.getElementById(e);if(!r)return;for(;r.hasChildNodes();)r.removeChild(r.firstChild)}})}),_._each(a,function(e){e.utCalled=!1,e.displayed=!1});try{Ie()}catch(r){_.logError("refreshTags "+r.message)}},be=function(){ye(this.targetId)},Te=function(e){var t={};return 0===e.length?apntag.requests.tags:(_._each(apntag.requests.tags,function(n,a){for(var r=0;r<e.length;r++)e[r]===a&&(t[a]=n)}),t)},Ie=function(){_._each(P,function(e,t){if("none"===t)_e(t);else{var n=Number(t);isNaN(n)?_.logError("Invalid value for member"):_e(n)}})},_e=function(e){var t=O.buildRequestJsonByMemberId(apntag.requests,e,j),n=le(t);return _.isEmpty(t.tags)?void _.logWarn("ast.loadTagsByMemberId: no defined tags at this point so no /UT request will be made"):void("withCredentials"in new XMLHttpRequest?ue(n,e):De(n,e))},we=function(e,t){var n=e.member;return apntag.requests=apntag.requests||{},apntag.requests.tags=apntag.requests.tags||{},apntag.requests.utCalled=apntag.requests.utCalled||!1,apntag.requests.hasLeft=apntag.requests.hasLeft||!1,apntag.requests.cbCalled=apntag.requests.cbCalled||!1,apntag.requests.tags[t]=e,apntag.requests.tags[t].utCalled=apntag.requests.tags[t].utCalled||!1,apntag.requests.tags[t].showTagCalled=apntag.requests.tags[t].showTagCalled||!1,apntag.requests.tags[t].displayed=apntag.requests.tags[t].displayed||!1,apntag.requests.tags[t].on=apntag.onEvent||void 0,apntag.requests.tags[t].off=apntag.offEvent||void 0,apntag.requests.tags[t].setSizes=apntag.setSizes||void 0,apntag.requests.tags[t].modifyTag=apntag.modifyTag||void 0,apntag.requests.tags[t].refresh=be||void 0,P[n]=typeof P[n]===te?[]:P[n],P[n].push(e.targetId),x[e.targetId]&&(apntag.requests.tags[t].showTagCalled=!0),apntag.requests.tags[t]},Ae=function(e,t){var n="";n=Oe(t,t.targetId),e.contentWindow.contents=n,e.src='javascript:window["contents"];'},Ne=function(e,t){var n="",a=Re(e);n=Oe(t,t.targetId),a.open("text/html","replace"),a.write(n),a.close()},Se=function(e,t){var n="";if(e.isMediated)n=e.ad.mediatedContent,_.logMessage("Invoking mediation for displaying banner ad: "+t);else if(e.adResponse&&1===e.adResponse.ads.length){var a=getAdObjFromAdsArray(e.adResponse.ads);n=a[G][Y]}var r='<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head><base target="_top" /><script>inDapIF=true;apntag_targetId = "'+t+'";window.onerror = function(e){ if(window.parent && window.parent.apntag){window.parent.apntag.recordErrorEvent(e,"'+t+'");  return true; } };</script></head><body><script>document.body.id = "'+t+'";</script>'+n+"</body></html>";return r},Oe=function(e,t){e.adWrap=Se(e,t);var n='<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head><base target="_top" /><script>inDapIF=true;window.onload = function(){window.onerror = function(e){ if(window.parent && window.parent.apntag){window.parent.apntag.recordErrorEvent(e,"'+t+'");  return true; } };if(window.parent && window.parent.apntag){var adWrap = window.parent.apntag.getAdWrap("'+t+'");document.open("text/html", "replace");document.write(adWrap);document.close();}};</script></head><body></body></html>';return n},Re=function(e){var t;try{t=e.contentWindow?e.contentWindow.document:e.contentDocument.document?e.contentDocument.document:e.contentDocument}catch(n){_.logError("Error getting iframe document: "+n)}return t},De=function(e,n){var a=t(),r=qe(e),o=_.loadScript(a,r);apntag.requests.utCalled=!0,ie(n),o.onload=function(){_.logMessage("JSONP fallback used instead of POST.")},o.onerror=function(t){if(!apntag.requests.errorReported){var a="Unknown script error contacting endpoint over JSONP. Endpoint: "+e.url;u(a,n,"-1",A.EVENTS.REQUEST_FAIL,t),_.logError(a)}},o.onreadystatechange=function(t){if(!("loaded"!==o.readyState&&"complete"!==o.readyState||apntag.requests.cbCalled||apntag.requests.errorReported)){apntag.requests.errorReported=!0;var a="Unknown network error contacting endpoint over JSONP. Endpoint: "+e.url;u(a,n,"-1",A.EVENTS.REQUEST_FAIL,t),_.logError(a)}}},qe=function(e){var t=e.url+(e.url.indexOf("?")+1?"&":"?")+"cb=apntag.handleCb&q="+e.data;return t},Ce=function(e){apntag.requests.tags=apntag.requests.tags||{};var t=!0,n=apntag.requests.tags[e];return typeof n===te&&(t=!1),t},Pe=function(){apntag.requests.hasLeft=!1,_._each(apntag.requests.tags,function(e,t){e.displayed||e.prebid||e.isMediated||(_.logWarn(t+" is not displayed.",A.LOG.WARN),apntag.requests.hasLeft=!0)}),apntag.requests.hasLeft||_.logMessage("all Tags are displayed.")},Me=function(e){function t(){n||(n=!0,e())}var n=!1;if(document.addEventListener)document.addEventListener("DOMContentLoaded",t,!1);else if(document.attachEvent){try{var a=null!==window.frameElement}catch(r){}if(document.documentElement.doScroll&&!a){var o=function(){if(!n)try{document.documentElement.doScroll("left"),t()}catch(e){setTimeout(o,10)}};o()}document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&t()})}if(window.addEventListener)window.addEventListener("load",t,!1);else if(window.attachEvent)window.attachEvent("onload",t);else{var i=window.onload;window.onload=function(){i&&i(),t()}}};Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var n;if(null===this)throw new TypeError('"this" is null or not defined');var a=Object(this),r=a.length>>>0;if(0===r)return-1;var o=+t||0;if(Math.abs(o)===1/0&&(o=0),o>=r)return-1;for(n=Math.max(o>=0?o:r-Math.abs(o),0);r>n;){if(n in a&&a[n]===e)return n;n++}return-1}),_.logTimestamp("AST library loaded"),se(),apntag.requests.checkDisplay||Me(Pe),"function"==typeof window.define&&window.define.amd&&window.define("appnexusAst",[],function(){return window.apntag}),apn_testonly={},apn_testonly.getPageTargetingParams=function(){return apntag.requests.targetingParams},apn_testonly.getEvents=function(){return w.get()},apn_testonly.getEvent=function(e,t){var n,a=w.get();return _._each(a[e],function(e){null!==e[t]&&void 0!==e[t]&&(n=e[t])}),n},apn_testonly.buildPostRequestParams=function(e){return le(e)},apn_testonly.getContentSourceForMediation=function(e){return N.getContentSourceForMediation(e)},apn_testonly.getRequestTagsforRefresh=function(e){return Te(e)},apn_testonly.getTag=function(e){return _.logMessage("getTag called for tag "+e),Ce(e)?e&&apntag.requests.tags&&apntag.requests.tags[e]?apntag.requests.tags[e]:void 0:void _.logError("the "+e+" tag is not defined.",A.LOG.WARN)},apn_testonly.getEndPoint=function(){return ce()},apn_testonly.getKeyForSyncTags=function(e){return s(e)},apn_testonly.getAllRequest=function(){return apntag.requests},apn_testonly.getJSONPUrl=function(e){return qe(e)},apn_testonly.getInternalTagArr=function(){return j}}).call(t,function(){return this}())},function(e,t,n){var a=n(2),r=Array.prototype.slice,o=n(3),i=a._map(o.EVENTS,function(e){return e});e.exports=function(){function e(e,t){var o=t[0],i=r.call(t,1);a.logMessage("Emitting event for: "+e+" for ad tag: "+o),a._each(n[e],function(e){var t=e[o];if(null!==t&&void 0!==t&&"function"==typeof t)try{t.apply(null,i)}catch(n){a.logError("events._dispatch: Error executing event handler function: "+n.message)}})}function t(e){return a.contains(i,e)}var n={},o={};return o.on=function(e,r,o){if(t(e)){var s={};s[r]=o,n[e]=n[e]||[],n[e].push(s)}else a.logError("Wrong event name : "+e+" Valid event names :"+i)},
o.emit=function(t){var n=r.call(arguments,1);e(t,n)},o.off=function(e,t,r){a.isEmpty(n[e])||a._each(n[e],function(e){null!==e[t]&&void 0!==e[t]&&("undefined"!=typeof r&&e[t]!==r||(e[t]=null))})},o.get=function(){return n},o}()},function(e,t){"object"!=typeof JSON&&(JSON={}),function(){"use strict";function e(e){return 10>e?"0"+e:e}function t(){return this.valueOf()}function n(e){return r.lastIndex=0,r.test(e)?'"'+e.replace(r,function(e){var t=s[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function a(e,t){var r,s,g,u,l,c=o,p=t[e];switch(p&&"object"==typeof p&&"function"==typeof p.toJSON&&(p=p.toJSON(e)),"function"==typeof d&&(p=d.call(t,e,p)),typeof p){case"string":return n(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p)return"null";if(o+=i,l=[],"[object Array]"===Object.prototype.toString.apply(p)){for(u=p.length,r=0;u>r;r+=1)l[r]=a(r,p)||"null";return g=0===l.length?"[]":o?"[\n"+o+l.join(",\n"+o)+"\n"+c+"]":"["+l.join(",")+"]",o=c,g}if(d&&"object"==typeof d)for(u=d.length,r=0;u>r;r+=1)"string"==typeof d[r]&&(s=d[r],g=a(s,p),g&&l.push(n(s)+(o?": ":":")+g));else for(s in p)Object.prototype.hasOwnProperty.call(p,s)&&(g=a(s,p),g&&l.push(n(s)+(o?": ":":")+g));return g=0===l.length?"{}":o?"{\n"+o+l.join(",\n"+o)+"\n"+c+"}":"{"+l.join(",")+"}",o=c,g}}var r=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=t,Number.prototype.toJSON=t,String.prototype.toJSON=t);var o,i,s,d;"function"!=typeof JSON.stringify&&(s={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(e,t,n){var r;if(o="",i="","number"==typeof n)for(r=0;n>r;r+=1)i+=" ";else"string"==typeof n&&(i=n);if(d=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return a("",{"":e})})}()},function(e,t,n){var a=n(2),r=n(3),o=t,i=[],s=!1,d=r.EXTERNAL_LIB.VIDEO_MEDIATION_JS,g=r.EXTERNAL_LIB.BANNER_MEDIATION_JS,u=r.UT_RESPONSE_PROP.AD_TYPE,l=r.AD_TYPE.BANNER,c=r.AD_TYPE.VIDEO;o.checkIfMediatedResponse=function(e){var t=!1;return e&&a._each(e,function(e){return"csm"===e.content_source?void(t=!0):void 0}),t},o.getMediationType=function(e){var t=l;return e&&a._each(e,function(e){return e[u]===c?void(t=c):void 0}),t},o.callMediationFramework=function(e,t,n,r){var o=this;e===c&&(null!==t&&i.push(t),s&&window.APNVideo_AstMediationManager?a._each(i,function(e){if(!e.called)try{window.APNVideo_AstMediationManager.selectAd(e.uuid,e,n,r),e.called=!0}catch(t){a.logError("Error invoking video mediation","mediationmanager.js",t)}}):(a.loadScript(window,d,function(){o.callMediationFramework(c,null,n,r)}),s=!0))},o.getMediationOptions=function(e,t){var n={};return a._each(e,function(e){e.uuid===t.uuid&&e.mediationOptions&&(n=e.mediationOptions)}),n},o.getAdObjByMediation=function(e){return e.isMediated?e.adResponse.ad:e.adResponse.ads[0]},o.copyAdObjforMediation=function(e){return e.isMediated||(e.adResponse.ad=e.adResponse.ads[0]),e},o.getContentSourceForMediation=function(e){var t=e.content_source,n=e.ad_type;return t?e[t][n]:void 0},o.getContentForBannerMediation=function(e,t){var n="<script>";return n+="var APN_macros = {};",n+='APN_macros.uuid = "'+e+'";',n+="APN_macros.ads = ",n+='window.parent.apntag.getAdMarkup("'+e+'", "'+t.uuid+'");',n+=";",n+="document.write('<scr' + 'ipt src=\""+g+"\"></scr' + 'ipt>');",n+="</script>"}},function(e,t){function n(){var e=document.createElement("iframe");return e.id="loader",e.height="100%",e.width="100%",e.border="0px",e.hspace="0",e.vspace="0",e.marginWidth="0",e.marginHeight="0",e.style.border="0",e.frameBorder="0",e}var a=t;a.load=function(e){e=e.replace(/(\n)/g,"<br>");var t=document.body,a=document.createElement("div");a.id="appnexus_debug_window";var r=document.createElement("div");r.style.width="100%",r.style.height="400px",r.style.clear="both",t.insertBefore(r,null);var o=a.style;o.position="fixed",o.bottom="0px",o.left="0px",o.width="100%",o.height="450px",o.overflow="hidden",o["border-top"]="1px solid",o["z-index"]=999999,o.background="white",t.insertBefore(a,null);var i=document.createElement("div");i.style.width="100%",i.style.height="30px";var s=n();a.appendChild(s);var d=s.contentWindow.document;s.onload=function(){var e,t,n,a=d.getElementsByTagName("br"),r=a.length,o=0;for(o;r-1>o;o++)n=!1,e=a[o].nextSibling,t=e.nodeName.toLowerCase(),"br"==t&&(n=!0),n&&(e.style.display="none")};var g="</script>";d.open(),d.write(e),d.write(g),d.close()}},function(e,t,n){function a(e,t,n){var a={};return apntag.debug&&!o.isEmpty(t)&&(a.enabled=!0,e?a.member_id=Number(e):"",t?a.dongle=String(t):"",n?a.bidder_id=Number(n):"",a.debug_timeout=1e3),apntag.test&&(a.test=apntag.test),a}function r(e){var t=[];return o._each(e,function(e,n){o.isStr(e)&&(e=[e]);var a={key:n,value:e};t.push(a)}),t}var o=n(2),i=n(3),s=n(10),d=t,g=i.DEBUG.AST_DONGLE,u=i.DEBUG.AST_TEST,l=i.DEBUG.AST_DEBUG_MEMBER,c=i.DEBUG.AST_DEBUG_BIDDER,p=function(e){var t={},n=e.site;return o.isEmpty(n)||o.isEmpty(n.id)||(t.id=n.id),t},f=function(e){var t={},n=e.app;return o.isEmpty(n)||o.isEmpty(n.appid)||(t.appid=n.appid),t},m=function(e){var t={},n=e.device;return o.isEmpty(n)||(o.isEmpty(n.useragent)||(t.useragent=n.useragent),o.isEmpty(n.geo)||(t.geo=n.geo),o.isEmpty(n.ip)||(t.ip=n.ip),o.isEmpty(n.deviceType)||(t.devicetype=n.deviceType),o.isEmpty(n.make)||(t.make=n.make),o.isEmpty(n.model)||(t.model=n.model),o.isEmpty(n.os)||(t.os=n.os),o.isEmpty(n.osVersion)||(t.os_version=n.osVersion),o.isEmpty(n.carrier)||(t.carrier=n.carrier),o.isEmpty(n.connectionType)||(t.connectiontype=n.connectionType),o.isEmpty(n.mcc)||(t.mcc=n.mcc),o.isEmpty(n.mnc)||(t.mnc=n.mnc),o.isEmpty(n.lmt)||(t.lmt=n.lmt),o.isEmpty(n.deviceId)||(t.device_id=n.deviceId),o.isEmpty(n.devTime)||(t.devtime=n.devTime)),t};d.createPageUser=function(e){var t={};return o.isEmpty(e)||(e.externalUid&&o.isStr(e.externalUid)&&(t.external_uid=e.externalUid),o.isEmpty(e.segments)||(t.segments=e.segments),o.isEmpty(e.age)||(t.age=e.age),o.isEmpty(e.gender)||(t.gender=e.gender),o.isEmpty(e.language)||(t.language=e.language),e.dnt&&(t.dnt=e.dnt)),t},d.createTag=function(e){var t={};if(e.uuid=o.getUUID(),!o.isEmpty(e.sizes)){var n=this.getSizes(e.sizes);o.isEmpty(n)||(t.sizes=n,t.primary_size=n[0])}if(!o.isEmpty(e.privateSizes)){var a=this.getSizes(e.privateSizes);o.isEmpty(a)||(t.private_sizes=a)}if(e.supplyType&&o.isStr(e.supplyType)&&(t.supply_type=e.supplyType),e.pubClick&&o.isStr(e.pubClick)&&(t.pubclick=e.pubClick),e.pubClickEnc&&o.isStr(e.pubClickEnc)&&(t.pubclickenc=e.pubClickEnc),e.reserve&&(o.isNumber(e.reserve)||o.isArray(e.reserve))&&(t.reserve=e.reserve),e.extInvCode&&o.isStr(e.extInvCode)&&(t.ext_inv_code=e.extInvCode),t.uuid=e.uuid,e.tagId&&(t.id=e.tagId),e.formats&&(t.formats=e.formats),e.position&&("above"===e.position?t.position=1:"below"===e.position?t.position=2:t.position=0),e.invCode&&(t.code=e.invCode),e.prebid&&(t.prebid=e.prebid),e.impId&&(t.imp_id=e.impId),e.allowSmallerSizes===!0?t.allow_smaller_sizes=!0:t.allow_smaller_sizes=!1,e.disablePsa===!0&&(t.disable_psa=!0),e.allowedFormats&&(t.ad_types=e.allowedFormats),!o.isEmpty(e.video)){var i=e.video,s={};i.id&&(s.id=i.id),o.isEmpty(i.mimes)||(s.mimes=i.mimes),i.maxDuration&&(s.maxduration=i.maxDuration),i.minDuration&&(s.minduration=i.minDuration),i.startDelay&&(s.startdelay=i.startDelay),i.skippable&&(s.skippable=i.skippable),o.isEmpty(i.playbackMethod)||(s.playback_method=i.playbackMethod),o.isEmpty(i.frameworks)||(s.frameworks=i.frameworks),t.video=s}if(!o.isEmpty(e.keywords)){var d=r(e.keywords);t.keywords=d}if(e.forceCreativeId){var g=Number(e.forceCreativeId);isNaN(g)?o.logError("Force Creative must be a number"):(t.force_creative_id=g,o.logMessage("Force Creative in use for targetId: "+e.targetId))}return e.nobidIfUnsold&&(t.nobid_if_unsold=!0),e.trafficSourceCode&&(t.traffic_source_code=e.trafficSourceCode.toString()),t},d.getSizes=function(e){var t=[],n={};if(o.isArray(e)&&2===e.length&&!o.isArray(e[0]))n.width=parseInt(e[0],10),n.height=parseInt(e[1],10),t.push(n);else if("object"==typeof e)for(var a=0;a<e.length;a++){var r=e[a];n={},n.width=parseInt(r[0],10),n.height=parseInt(r[1],10),t.push(n)}return t},d.buildRequestJsonByMemberId=function(e,t,n){var i={};e.disablePsa&&o._each(e.tags,function(e){e.disablePsa=!0});var E=[],v=0;o._each(e.tags,function(e){if(!e.utCalled&&e.member===t){var n=d.createTag(e);e.utCalled=!0,e.tagNumber=v,v++,E.push(n)}}),s.build(e.tags,E,n),i.tags=E,i.uuid=o.getUUID(),i.member_id=t;var h=null;o.isEmpty(e.keywords)?o.isEmpty(e.targetingParams)||(h=r(e.targetingParams),i.keywords=h):(h=r(e.keywords),i.keywords=h),o.isEmpty(e.user)||(i.user=this.createPageUser(e.user)),o.isEmpty(e.device)||(i.device=m(e)),o.isEmpty(e.app)||(i.app=f(e)),o.isEmpty(e.site)||(i.site=p(e)),i.tags=E;var y=o.getParameterByName(g);y&&""!==y&&(apntag.dongle=y);var b=o.getParameterByName(l);b&&""!==b&&(apntag.debug_member=b);var T=o.getParameterByName(c);T&&""!==T&&(apntag.debug_bidder=T);var I="TRUE"===o.getParameterByName(u).toUpperCase();if(I&&""!==I&&(apntag.test=I),apntag.test||apntag.debug&&!o.isEmpty(apntag.dongle)){var _="";apntag.debug_member&&(_=apntag.debug_member);var w=a(_,apntag.dongle,apntag.debug_bidder);i.debug=w}return i}},function(e,t,n){function a(e){return i.getParameterByName(e,d.queryString)}function r(e,t){var n=null;return i._each(t,function(t){t.uuid===e.uuid&&(n=t.targetId)}),n}function o(e,t,n){var a=Number(t);if(isNaN(a))i.logError("Force Creative must be a number");else{e[h]=a,apntag.test=!0;var o=r(e,n);i.logMessage("Force Creative in use for targetId: "+o)}}var i=n(2),s=n(3),d=t,g=[],u=s.DEBUG.AST_OVERRIDE,l=u.BASE,c=l+u.DIV,p=l+u.INDEX,f=l+u.TAG_ID,m=l+u.INV_CODE,E=",",v=":",h="force_creative_id";d.queryString=void 0,d.build=function(e,t,n){if(i.stringContains(d.queryString||i.getSearchQuery(),l)){if(!i.isEmpty(a(p))){g=a(p).split(E);for(var r=0;r<g.length;r++){var s=g[r].split(v),u=Number(s[0]);if(isNaN(u)||void 0===t[u])i.logError("Invalid ast_override value for index : "+u);else{for(var h=null,y=null,b=0;b<n.length;b++)b===u&&(y=n[b].uuid);for(var T=0;T<t.length;T++)t[T].uuid===y&&o(t[T],s[1],e)}}}if(!i.isEmpty(a(c))){g=a(c).split(E);for(var r=0;r<g.length;r++){var I,s=g[r].split(v);if(i._each(e,function(e,t){t===s[0]&&(I=e.uuid)}),I)for(var _=0;_<t.length;_++)t[_].uuid===I&&o(t[_],s[1],e);else i.logError("Invalid ast_override value for target div id : "+s[0])}}if(!i.isEmpty(a(f))){g=a(f).split(E);for(var r=0;r<g.length;r++){for(var s=g[r].split(v),w=!1,_=0;_<t.length;_++){var h=t[_];h.id===Number(s[0])&&(o(h,s[1],e),w=!0)}w||i.logError("Invalid ast_override value for tag id : "+s[0])}}if(!i.isEmpty(a(m))){g=a(m).split(E);for(var r=0;r<g.length;r++){for(var s=g[r].split(v),A=!1,_=0;_<t.length;_++){var h=t[_];h.code===s[0]&&(o(h,s[1],e),A=!0)}A||i.logError("Invalid ast_override value for invCode : "+s[0])}}return t}}}]);